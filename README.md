# msCatalogFilter
Для работы нид pdoTools и minishop2, теоритический кутёж [тут](https://trywar.ru/3/173/)

# Возможности
- Фильтрация товаров по TV, цене и опциям
- Фильрация товаров по категориям
- Поиск товаров
- Подгрузка товаров Ajax
- Сортировка товаров
- Возможность использовать ползунки jQuery UI
- Анимация загрузки
- Встроенный js код для разварачивания и сворачивания блоков фильтров с запоминанем в localStorage

# Как использовать
## Подключение и настройка необходимых скриптов
Сначала нужно подключить всё необходимое:

* создаём сниппет _CatalogFilter_ и пихаем в него код из файла _CatalogFilter.php_
* Подключаем к документу скрипт из файла _CatalogFilter.js_

В начале файла _CatalogFilter.php_ необходимо указать TV поля и name полей которые используются для сортировки

## Вызов списка товаров
```
[[!msCatalogFilter?
  &tpl=`tpl`
  &limit=`8`
  &parents=`[[*id]]`
  &fields=`price`
  &sortby=`menuindex`
  &sortdir=`ASC`
]]
```
Где _fields_ необходимые tv поля

Так же можно юзать всё что есть в pdoResources

## Настройка html
В файле _index.html_ есть примеры всех html блоков, с кодами js, нужные из них для удобства можно преенести в  _CatalogFilter.js_  
Главное чтобы совпадали и были все необходимы классы и в html и в  _CatalogFilter.js_

## Настройка обработки ajax
Все силекторы и параметры можно найти в начале _CatalogFilter.js_
Нужно чтобы были указаны все необходимые классы
```
ajaxContainerSelector = '.ajax-container', // Блок с результатами
ajaxItemSelector      = '.ajax-item', // Элемент выдачи (tpl)
ajaxFormSelector      = '.ajax-form', // Форма с фильтрами
ajaxFormButtonStart   = '.ajax-start', // Старт фильтрации
```
Класс _.ajax-disabled_ для _input_ отменяет его моментальную обработку при изменении его значения

## Подключение jQuery UI slider (Ползунок для цен)
Естетственно нужно подключить сам jQuery UI slider, его можно найти тут https://jqueryui.com/download/
Необходимый код есть в index.html и отдельно в jQueryUISlider.js запихать туда куда сочтёте нужным (:

## Сортировка
Для работы сортировки в `index.html` лежит форма сортировки и в форме фильтра есть input `sortBy`.

Весь необходимый js в `msCatalogFilter.js`.

Также понадобится подключить плагин `plugin.msCatalogFilter.php` с обработкой события `OnPageNotFound` для хранения данных в сессии.

Все параметры сортировки хранятся в сессии, и после обновления страницы сортировка сохраняется.

## Поиск
Для поиска надо добавить input с _.ajax-search_ в форму фильтра, или дублировать в него значения если поле поиска находится за пределами формы

## Дополнительные материалы
### Число товаров в каталоге _fenom_
```
{set $count = 'msProducts' | snippet : [
    'parents' => $id,
    'returnIds' => true,
    'limit' => 0,
]}

{set $count = !$count ? 0 : $count | split | length}
Все товары ({$count})
```

### Максимальная цена в каталоге
Может понадобится для фильтра с ценой, чтобы нельзя было указать цену выше той что есть в каталоге

Нужно создать сниппет с кодом из файла _msMaxPrice.php_

Выводить его следующим образом

```
[[msMaxPrice? parents=`[[*id]]`]]
```

### Если используется TV checkbox

для того чтобы вывести возможные значения можно воспользоватся кодом из _TVsSelectValues.php_
Он <strike>нагло сп</strike> скромно взят с замечательного блога http://mycode.in.ua/modx/snippets/list-tv-elements.html
